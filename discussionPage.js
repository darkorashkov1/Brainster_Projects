const discussionCards = [
  {
    id: 1,
    bgClass: "bg-discussion",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија.",
    imgSrc: "./img/Discussion Board/Person_1.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 2,
    bgClass: "bg-needToKnow",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија.",
    imgSrc: "./img/Discussion Board/Person_2.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 3,
    bgClass: "bg-discussion",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија.",
    imgSrc: "./img/Discussion Board/Person_3.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 4,
    bgClass: "bg-needToKnow",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години, кога непознат печатар зел кутија со букви и ги сложил на таков начин за да направи примерок на книга. И не само што овој модел опстанал пет векови туку почнал да се користи и во електронските медиуми, кој се уште не е променет. Се популаризирал во 60-тите години на дваесеттиот век со издавањето на збирка од страни во кои се наоѓале Lorem Ipsum пасуси, а денес во софтверскиот пакет како што е Aldus PageMaker во кој се наоѓа верзија на Lorem Ipsum.",
    imgSrc: "./img/Discussion Board/Person_4.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 5,
    bgClass: "bg-progress",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години, кога непознат печатар зел кутија со букви и ги сложил на таков начин за да направи примерок на книга. И не само што овој модел опстанал пет векови туку почнал да се користи и во електронските медиуми, кој се уште не е променет. Се популаризирал во 60-тите години на дваесеттиот век со издавањето на збирка од страни во кои се наоѓале Lorem Ipsum пасуси, а денес во софтверскиот пакет како што е Aldus PageMaker во кој се наоѓа верзија на Lorem Ipsum.",
    imgSrc: "./img/Discussion Board/Person_5.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 6,
    bgClass: "bg-progress",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години, кога непознат печатар зел кутија со букви и ги сложил на таков начин за да направи примерок на книга. И не само што овој модел опстанал пет векови туку почнал да се користи и во електронските медиуми, кој се уште не е променет. Се популаризирал во 60-тите години на дваесеттиот век со издавањето на збирка од страни во кои се наоѓале Lorem Ipsum пасуси, а денес во софтверскиот пакет како што е Aldus PageMaker во кој се наоѓа верзија на Lorem Ipsum.",
    imgSrc: "./img/Discussion Board/Person_6.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 7,
    bgClass: "bg-discussion",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години, кога непознат печатар зел кутија со букви и ги сложил на таков начин за да направи примерок на книга. И не само што овој модел опстанал пет векови туку почнал да се користи и во електронските медиуми, кој се уште не е променет. Се популаризирал во 60-тите години на дваесеттиот век со издавањето на збирка од страни во кои се наоѓале Lorem Ipsum пасуси, а денес во софтверскиот пакет како што е Aldus PageMaker во кој се наоѓа верзија на Lorem Ipsum.",
    imgSrc: "./img/Discussion Board/Person_7.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 8,
    bgClass: "bg-needToKnow",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години.",
    imgSrc: "./img/Discussion Board/Person_8.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 9,
    bgClass: "bg-needToKnow",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години, кога непознат печатар зел кутија со букви и ги сложил на таков начин за да направи примерок на книга.",
    imgSrc: "./img/Discussion Board/Person_9.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
  {
    id: 10,
    bgClass: "bg-needToKnow",
    bodyText:
      "Лорем ипсум е едноставен модел на текст кој се користел во печатарската индустрија. Лорем ипсум бил индустриски стандард кој се користел како модел уште пред 1500 години, кога непознат печатар зел кутија со букви и ги сложил на таков начин за да направи примерок на книга. И не само што овој модел опстанал пет векови туку почнал да се користи и во електронските медиуми, кој се уште не е променет. Се популаризирал во 60-тите години на дваесеттиот век со издавањето на збирка од страни во кои се наоѓале Lorem Ipsum пасуси, а денес во софтверскиот пакет како што е Aldus PageMaker во кој се наоѓа верзија на Lorem Ipsum.",
    imgSrc: "./img/Discussion Board/Person_10.png",
    name: "Име Презиме",
    date: "00/00/00, 00:00",
    commentsCount: 5,
    reactionsCount: 84,
  },
];

function addDiscussionCards() {
  const container = document.querySelector("#discussionCardsRow");

  discussionCards.forEach((card) => {
    const cardHtml = `
        <div class="col-md-6 col-lg-4 discussionCards">
          <div class="card mb-4 ${card.bgClass}">
            <div class="card-body">
              <p class="mb-3">${card.bodyText}</p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                  <img src="${card.imgSrc}" class="ui-w-40 rounded-circle mr-2" alt="">
                  <div class="mx-2">${card.name}</div>
                </div>
                <div class="text-muted small">${card.date}</div>
              </div>
              <div class="mt-3">
                <input class="form-control bg-transparent rounded-0 border-0 p-0 border-bottom border-dark mx-0 comment-input"
                  type="text" placeholder="Пиши коментар…">
              </div>
              <div class="d-flex justify-content-between mt-3">
                <div class="text-muted"><i class="fa-solid fa-plus"></i>&nbsp; <span class="mx-2">${card.commentsCount} Коментари</span></div>
                <div class="text-muted"><span class="mx-2">${card.reactionsCount} Реакции</span></div>
              </div>
            </div>
          </div>
        </div>
      `;

    container.insertAdjacentHTML("beforeend", cardHtml);
  });
}

function isUserSignedIn() {
  return localStorage.getItem("isLoggedIn") === "true";
}

document.addEventListener("DOMContentLoaded", function () {
  addDiscussionCards();

  if (isUserSignedIn()) {
    // If the user is signed in, display the user share card
    document.querySelector(".user-share-card").classList.remove("d-none");
  } else {
    // If the user is not signed in, disable comment inputs and show a message
    const commentInputs = document.querySelectorAll(".comment-input");
    commentInputs.forEach((input) => {
      input.setAttribute("disabled", "disabled");
      input.placeholder = "Мора да бидете најавени за да коментирате";
    });
  }
});

// Add comment

function addCommentOnEnter(event) {
  // Check if the pressed key is Enter (code 13)
  if (event.keyCode === 13) {
    event.preventDefault();

    const commentInput = event.target;

    const commentText = commentInput.value.trim();

    if (commentText !== "") {
      // Available bg classes
      const bgClasses = ["bg-discussion", "bg-needToKnow", "bg-progress"];

      const randomIndex = Math.floor(Math.random() * bgClasses.length);

      const randomBgClass = bgClasses[randomIndex];

      // Create a new comment
      const newComment = {
        bodyText: commentText,
        name: "Your Name",
        date: new Date().toLocaleString(),
        imgSrc: "./img/Discussion Board/Person_0.png",
        commentsCount: 0,
        reactionsCount: 0,
        bgClass: randomBgClass,
      };

      discussionCards.push(newComment);

      // Save discussionCards
      localStorage.setItem("discussionCards", JSON.stringify(discussionCards));

      // Create the HTML for the new comment
      const newCommentHtml = `
          <div class="col-md-6 col-lg-4">
            <div class="card mb-4 ${randomBgClass}"> <!-- Add the random bg class to the card -->
              <div class="card-body pb-0 mb-0">
                <p class="mb-0">${newComment.bodyText}</p>
              </div>
              <div class="d-flex justify-content-between align-items-center p-3">
                <div class="d-flex media align-items-center">
                  <div><img src="${newComment.imgSrc}" class="d-block ui-w-40 rounded-circle" alt=""></div>
                  <div class="mx-3">${newComment.name}</div>
                </div>
                <div class="text-muted small">${newComment.date}</div>
              </div>
              <div class="mx-3">
                <input class="form-control bg-transparent rounded-0 border-0 p-0 border-bottom border-dark mx-0 comment-input"
                  type="text" placeholder="Пиши коментар…">
              </div>
              <div class="d-flex align-items-center px-3 pb-3 mt-3">
                <div class="text-muted"><i class="fa-solid fa-plus"></i>&nbsp; <span class="mx-3">${newComment.commentsCount} Коментари</span></div>
                <div class="text-muted"><span class="mx-3">${newComment.reactionsCount} Реакции</span></div>
              </div>
            </div>
          </div>
        `;

      // Insert the new comment HTML before the user share card
      const userShareCard = document.querySelector(".user-share-card");
      userShareCard.insertAdjacentHTML("afterend", newCommentHtml);

      // Clear input
      commentInput.value = "";
    }
  }
}

window.onload = function () {
  let discussionCards =
    JSON.parse(localStorage.getItem("discussionCards")) || [];

  const commentInput = document.querySelector(".user-share-card input");
  commentInput.addEventListener("keydown", addCommentOnEnter);

  addDiscussionCards(discussionCards);

  if (isUserSignedIn()) {
    document.querySelector(".user-share-card").classList.remove("d-none");
  }
};
